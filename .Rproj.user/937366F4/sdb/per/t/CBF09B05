{
    "collab_server" : "",
    "contents" : "#'  Given an 2x2 table with ai, bi, ci and di, if there are any zero cells, a continuity correction\n#'  (CC) is added upto 0.5. This function checks if this addition of continuity correction causes\n#'  the reversing the Odds Ratio, Relative Risk and Risk Difference.\n#'  We provide 2 ways to add this CC. Adding CC to all the cells or only to the zero cells.\n#'  The function will identify if there is a reversal and also give the point of reversal.\n#'  The continuity correction can be also graphed if the option is selected.\n#' @param ai - Numeric value\n#' @param bi - Numeric value\n#' @param ci - Numeric value\n#' @param di - Numeric value\n#' @param With.CI - Logical TRUE/FALSE. Default is FALSE\n#' @details  The function only analyzes 2x2 tables where there is at least 1 zero cell.\n#' By default it calculates the reversal point (if it exists) for various values of continuity correction\n#' (CC) starting from 10^(-8) (suggested by reference [5]) all the way to 0.5. If there is a reversal due to CC\n#' the function returns the graph showing the reversal for Odds Ratio.\n#' The function adds the CC using 2 methods.\n#' In Method 1 - it adds CC to all the cells (called All) which is a widespread practice\n#' In Method 2 - it adds CC to only the zero cells (called Only.Zero)\n#' Option is provided to graph the confidence interaval (CI).\n#' @return A graph showing the reversal if there is reversal. Or text if there is no reversal\n#' @family 2x2 Summary methods\n#' @examples\n#'## Example 1 - From reference [2] - reversal only when CC is added to the zero cells alone\n#' ai=80; bi=1; ci=39; di=0\n#' Plot.reversals.OR(ai,bi,ci,di, With.CI=FALSE)\n#'##  Example 2 - From reference [3] -reversal when CC is added\n#' ai=1; bi=33; ci=0; di=7\n#' Plot.reversals.OR(ai,bi,ci,di, With.CI=FALSE)\n#'## Example 3 - Above example with CI\n#' ai=1; bi=33; ci=0; di=7\n#' Plot.reversals.OR(ai,bi,ci,di, With.CI=TRUE)\n#' @references\n#' [1] J Sweeting, Michael, Alexander J Sutton, and Paul C Lambert.\n#' What to add to nothing? Use and avoidance of continuity corrections in meta-analysis of sparse data.\n#' Statistics in medicine 23.9 (2004): 1351-1375.\n#' [2] Song H, Zhu J, Lu D. Molecular-targeted first-line therapy for advanced gastric cancer.\n#' Cochrane Database of Systematic Reviews 2016, Issue 7. Art. No.: CD011461.\n#' [3] Lensen SF, Manders M, Nastri CO, Gibreel A, Martins WP, Templer GE, Farquhar C.\n#' Endometrial injury for pregnancy following sexual intercourse or intrauterine insemination.\n#' Cochrane Database of Systematic Reviews 2016, Issue 6. Art. No.: CD011424.\n#' [4] Nidorf SM, Eikelboom JW, Budgeon CA, Thompson PL.\n#' Low-dose colchicine for secondary prevention of cardiovascular disease.\n#' Journal of the American College of Cardiology 2013;61(4):404-10.\n#' @export\nPlot.reversals.OR<-function(ai,bi,ci,di,With.CI=FALSE){\n#   if ((class(ai) != \"numeric\") || class(bi) != \"numeric\" ||\n#        class(ci) != \"numeric\"  || class(di) != \"numeric\" )  stop(\"Inputs ai, bi, ci and di have to be numeric\")\n# if (ai*bi*ci*di>0)  stop(\"At least one of the inputs ai,bi,ci or di have to be zero\")\n# if ((class(With.CI)) != \"logical\") stop(\"With.CI has to be either TRUE or FALSE\")\n\nmrt = data.frame(a=ai,b=bi,c=ci,d=di)\ntpm8=1/100000000\ntpm4=1/10000\n\ncc.vals = c(tpm8,tpm4,0.0011,0.011,0.0151,0.11,.151,.21,.251,.31,.351,.41,.451,.5)\n\n\nvbn= In.Each.Row(mrt[1,],cc.vals)\nsvbn=cbind(mrt[1,],vbn)\nttrange.df=Find.RS.metric(svbn)\nif(ttrange.df$RS.all.or ==0 & ttrange.df$RS.zero.zor==0){\nreturn(\"There is no reversal to Plot\")\n  }\n\nRS.all.or=ttrange.df$RS.all.or[1]\nRS.zero.or=ttrange.df$RS.zero.zor[1]\n\n\n# Generating sequence and then calling rma for OR/RR/RD with CI\nif(RS.all.or>0){RS.all.or.seq=Find.sequence.rma(RS.all.or); orm.all=Find.rma.metric(ai,bi,ci,di,RS.all.or.seq, 1)}\nif(RS.zero.or>0){RS.zero.or.seq=Find.sequence.rma(RS.zero.or); orm.zero=Find.rma.metric(ai,bi,ci,di,RS.zero.or.seq, 4)}\n\ncc=Metric=Low=High=NULL\n###############################################################################################\n######## Taking care of conditions where there is no reversal #################################\nif(RS.all.or==0){\n  if(With.CI==TRUE){\n    #### With CI plot\n    pl2 = data.frame( orm.zero)\n    names(pl2)=c(\"cc\",\"Metric\", \"Low\", \"High\")\n    pl2.noci.df=data.frame(orm.zero)\n    names(pl2.noci.df)=c(\"cc\",\"Metric\", \"Low\", \"High\")\n    pl2.noci.df$Low=pl2.noci.df$Metric\n    pl2.noci.df$High=pl2.noci.df$Metric\n    pl2.noci.df$cigroup=\"Without CI\"\n    pl2$cigroup=\"With CI\"\n    pl2.noci.df$allz=\"CC added only to 0 cells\"\n    pl2$allz=\"CC added only to 0 cells\"\n    or.combined.df=rbind(pl2,pl2.noci.df)\n\n    p<-ggplot(or.combined.df,aes(cc,Metric))+geom_line()+\n      geom_point(data=or.combined.df,aes(x=cc,y=Metric))+\n      geom_line(data=or.combined.df)+\n      geom_ribbon(aes(ymin=Low, ymax=High), alpha=0.2) +\n      labs(title = \"Odds Ratio\",subtitle = \"No reversal when CC added to all cells\") +\n      ylab(\"Odds Ratio\") +\n      facet_wrap(allz~cigroup, scales = \"free\" )\n    # End of if condition with CI\n  print(p)\n  } else {\n    pl2 = data.frame( orm.zero)\nnames(pl2)=c(\"cc\",\"Metric\", \"Low\", \"High\")\n\nl2=as.character(pl2$cc[6])\ncpoint.pl2=pl2$cc[6]\n\npl2g.orz=pl2[6,]\np<-ggplot(pl2,aes(cc,Metric))+\n  geom_line(data=pl2)+\n  geom_point(data=pl2,aes(x=cc,y=Metric))+\n  geom_point(data=pl2g.orz, colour=\"blue\") +  # this adds a blue point\n  geom_text(data=pl2g.orz, label=l2, hjust=0,vjust=0)+ # this adds a label for the blue point\n  labs(title = \"Odds Ratio\",subtitle = \"No reversal when CC added to all cells\") +\n  ylab(\"Odds Ratio\") +\n  geom_hline(yintercept=1)\nprint(p)\n  } #End of plot without CI\n\n} # End of if condition when there is only 1 reversal\n\n###############################################################################################\n###########Creates a plot for both OR.all and OR.zero without CI ##############################\nif(RS.all.or>0 & RS.zero.or>0){\n  if(With.CI==TRUE){\n\n    pl = data.frame( orm.all)\n    names(pl)=c(\"cc\",\"Metric\", \"Low\", \"High\")\n    pl2 = data.frame( orm.zero)\n    names(pl2)=c(\"cc\",\"Metric\", \"Low\", \"High\")\n\n    pl2g.orz=pl2[6,]\n    pl1g.or=pl[6,]\n    #### With CI plot -pl\n    pl.noci.df=data.frame(orm.all)\n    names(pl.noci.df)=c(\"cc\",\"Metric\", \"Low\", \"High\")\n    pl.noci.df$Low=pl.noci.df$Metric\n    pl.noci.df$High=pl.noci.df$Metric\n    pl.noci.df$cigroup=\"Without CI\"\n    pl$cigroup=\"With CI\"\n    pl.noci.df$allz=\"CC added to all cells\"\n    pl$allz=\"CC added to all cells\"\n\n    #### With CI plot - pl2\n    pl2.noci.df=data.frame(orm.zero)\n    names(pl2.noci.df)=c(\"cc\",\"Metric\", \"Low\", \"High\")\n    pl2.noci.df$Low=pl2.noci.df$Metric\n    pl2.noci.df$High=pl2.noci.df$Metric\n    pl2.noci.df$cigroup=\"Without CI\"\n    pl2$cigroup=\"With CI\"\n    pl2.noci.df$allz=\"CC added only to 0 cells\"\n    pl2$allz=\"CC added only to 0 cells\"\n\n    or.combined.df=rbind(pl,pl.noci.df,pl2,pl2.noci.df)\n\n    p<-ggplot(or.combined.df,aes(cc,Metric))+geom_line()+\n      geom_point(data=or.combined.df,aes(x=cc,y=Metric))+\n      geom_line(data=or.combined.df)+\n      geom_ribbon(aes(ymin=Low, ymax=High), alpha=0.2) +\n      labs(title = \"Odds Ratio\") +\n      ylab(\"Odds Ratio\") +\n      facet_grid(cigroup~allz, scales = \"free\" )\n    # End of if condition with CI\n    print(p)\n    } else {\n    pl = data.frame( orm.all)\n    names(pl)=c(\"cc\",\"Metric\", \"Low\", \"High\")\n    pl2 = data.frame( orm.zero)\n    names(pl2)=c(\"cc\",\"Metric\", \"Low\", \"High\")\n\n    l1=as.character(pl$cc[6])\n    l2=as.character(pl2$cc[6])\n    cpoint.pl=pl$cc[6]\n    cpoint.pl2=pl2$cc[6]\n\n    pl2g.orz=pl2[6,]\n    pl1g.or=pl[6,]\n    p<-ggplot(pl,aes(cc,Metric))+geom_line(aes(color=\"CC added to all cells\"))+\n      geom_point(data=pl,aes(x=cc,y=Metric))+\n      geom_line(data=pl2,aes(color=\"CC added to only the 0 cells\"))+\n      geom_point(data=pl2,aes(x=cc,y=Metric))+\n      geom_point(data=pl2g.orz, colour=\"blue\") +  # this adds a blue point\n      geom_text(data=pl2g.orz, label=l2, hjust=0,vjust=0)+ # this adds a label for the blue point\n      geom_point(data=pl1g.or, colour=\"red\") +  # this adds a red point\n      geom_text(data=pl1g.or, label=l1, hjust=0,vjust=0)+ # this adds a label for the red point\n      labs(title = \"Odds Ratio\") +\n      ylab(\"Odds Ratio\") +\n      geom_hline(yintercept=1)\n\n    print(p)\n    } #End of plot without CI\n\n\n  } # End of if condition when there is both reversal\n\n} # End of OR function\n\n#'############################################################################################################\n#'  Given an 2x2 table with ai, bi, ci and di, if there are any zero cells, a continuity correction\n#'  (CC) is added upto 0.5. This function checks if this addition of continuity correction causes\n#'  the reversing the Odds Ratio, Relative Risk and Risk Difference.\n#'  We provide 2 ways to add this CC. Adding CC to all the cells or only to the zero cells.\n#'  The function will identify if there is a reversal and also give the point of reversal.\n#'  The continuity correction can be also graphed if the option is selected.\n#' @param ai - Numeric value\n#' @param bi - Numeric value\n#' @param ci - Numeric value\n#' @param di - Numeric value\n#' @param With.CI - Logical TRUE/FALSE. Default is FALSE\n#' @details  The function only analyzes 2x2 tables where there is at least 1 zero cell.\n#' By default it calculates the reversal point (if it exists) for various values of continuity correction\n#' (CC) starting from 10^(-8) (suggested by reference [5]) all the way to 0.5. If there is a reversal due to CC\n#' the function returns the graph showing the reversal for Relative Risk.\n#' The function adds the CC using 2 methods.\n#' In Method 1 - it adds CC to all the cells (called All) which is a widespread practice\n#' In Method 2 - it adds CC to only the zero cells (called Only.Zero)\n#' Option is provided to graph the confidence interaval (CI).\n#' @return A graph showing the reversal if there is reversal. Or text if there is no reversal\n#' @family 2x2 Summary methods\n#' @examples\n#'## Example 1 - From reference [2] - reversal only when CC is added to the zero cells alone\n#' ai=80; bi=1; ci=39; di=0\n#' Plot.reversals.RR(ai,bi,ci,di, With.CI=FALSE)\n#'##  Example 2 - From reference [3] -reversal when CC is added\n#' ai=1; bi=33; ci=0; di=7\n#' Plot.reversals.RR(ai,bi,ci,di, With.CI=FALSE)\n#'## Example 3 - Above example with CI\n#' ai=1; bi=33; ci=0; di=7\n#' Plot.reversals.RR(ai,bi,ci,di, With.CI=TRUE)\n#' @references\n#' [1] J Sweeting, Michael, Alexander J Sutton, and Paul C Lambert.\n#' \"What to add to nothing? Use and avoidance of continuity corrections in meta-analysis of sparse data.\"\n#' Statistics in medicine 23.9 (2004): 1351-1375.\n#' [2] Song H, Zhu J, Lu D. Molecular-targeted first-line therapy for advanced gastric cancer.\n#' Cochrane Database of Systematic Reviews 2016, Issue 7. Art. No.: CD011461.\n#' [3] Lensen SF, Manders M, Nastri CO, Gibreel A, Martins WP, Templer GE, Farquhar C.\n#' Endometrial injury for pregnancy following sexual intercourse or intrauterine insemination.\n#' Cochrane Database of Systematic Reviews 2016, Issue 6. Art. No.: CD011424.\n#' [4] Nidorf SM, Eikelboom JW, Budgeon CA, Thompson PL.\n#' Low-dose colchicine for secondary prevention of cardiovascular disease.\n#' Journal of the American College of Cardiology 2013;61(4):404-10.\n#' @export\nPlot.reversals.RR<-function(ai,bi,ci,di,With.CI=FALSE){\n  if ((class(ai) != \"numeric\") || class(bi) != \"numeric\" ||\n      class(ci) != \"numeric\"  || class(di) != \"numeric\" )  stop(\"Inputs ai,bi,ci and di have to be numeric\")\n  if (ai*bi*ci*di>0)  stop(\"At least one of the inputs ai,bi,ci or di have to be zero\")\n  if ((class(With.CI)) != \"logical\") stop(\"With.CI has to be either TRUE or FALSE\")\n\n  mrt = data.frame(a=ai,b=bi,c=ci,d=di)\n  tpm8=1/100000000\n  tpm4=1/10000\n  cc=Metric=Low=High=NULL\n\n  cc.vals = c(tpm8,tpm4,0.0011,0.011,0.0151,0.11,.151,.21,.251,.31,.351,.41,.451,.5)\n\n\n  vbn= In.Each.Row(mrt[1,],cc.vals)\n  svbn=cbind(mrt[1,],vbn)\n  #new.De=ibv.check(svbn)\n  ttrange.df=Find.RS.metric(svbn)\n  if(ttrange.df$RS.all.rr ==0 & ttrange.df$RS.zero.zrr==0){\n    return(\"There is no reversal to Plot\")\n  }\n\n  RS.all.rr=ttrange.df$RS.all.rr[1]\n  RS.zero.rr=ttrange.df$RS.zero.zrr[1]\n\n  # Generating sequence and then calling rma for OR/RR/RD with CI\n  if(RS.all.rr>0){RS.all.rr.seq=Find.sequence.rma(RS.all.rr); rrm.all=Find.rma.metric(ai,bi,ci,di,RS.all.rr.seq, 2)}\n  if(RS.zero.rr>0){RS.zero.rr.seq=Find.sequence.rma(RS.zero.rr); rrm.zero=Find.rma.metric(ai,bi,ci,di,RS.zero.rr.seq, 5)}\n\n###############################################################################################\n######## Taking care of conditions where there is no reversal #################################\n  if(RS.all.rr==0){\n    if(With.CI==TRUE){\n      #### With CI plot\n      rr2=data.frame(rrm.zero)\n      names(rr2)=c(\"cc\",\"Metric\", \"Low\", \"High\")\n      rr2.noci.df=data.frame(rrm.zero)\n      names(rr2.noci.df)=c(\"cc\",\"Metric\", \"Low\", \"High\")\n      rr2.noci.df$Low=rr2.noci.df$Metric\n      rr2.noci.df$High=rr2.noci.df$Metric\n      rr2.noci.df$cigroup=\"Without CI\"\n      rr2$cigroup=\"With CI\"\n      rr2.noci.df$allz=\"CC added only to 0 cells\"\n      rr2$allz=\"CC added only to 0 cells\"\n      rr.combined.df=rbind(rr2,rr2.noci.df)\n\n      p<-ggplot(rr.combined.df,aes(cc,Metric))+geom_line()+\n        geom_point(data=rr.combined.df,aes(x=cc,y=Metric))+\n        geom_line(data=rr.combined.df)+\n        geom_ribbon(aes(ymin=Low, ymax=High), alpha=0.2) +\n        labs(title = \"Relative Risk\", subtitle = \"No reversal when CC added to all cells\") +\n        ylab(\"Relative Risk\") +\n        facet_wrap(allz~cigroup, scales = \"free\" )\n      # End of if condition with CI\n      print(p)\n      } else {\n\n    rr2 = data.frame( rrm.zero)\n    names(rr2)=c(\"cc\",\"Metric\", \"Low\", \"High\")\n\n    l2.rr=as.character(rr2$cc[6])\n    point.rr2=rr2$cc[6]\n    rr2g.rrz=rr2[6,]\n    p<-ggplot(rr2,aes(cc,Metric))+\n      geom_line(data=rr2)+\n      geom_point(data=rr2,aes(x=cc,y=Metric))+\n      geom_point(data=rr2g.rrz, colour=\"blue\") +  # this adds a blue point\n      geom_text(data=rr2g.rrz, label=l2.rr, hjust=0,vjust=0)+ # this adds a label for the blue point\n      labs(title = \"Relative Risk\", subtitle = \"No reversal when CC added to all cells\") +\n      ylab(\"Relative Risk\") +\n      geom_hline(yintercept=1)\n    print(p)\n\n    } #End of plot without CI\n\n} # End of if condition when there is only 1 reversal\n\n\n  ###############################################################################################\n  ###########Creates a plot for both RR.all and RR.zero without CI ##############################\nif(RS.all.rr>0 & RS.zero.rr>0){\n  if(With.CI==TRUE){\n\n    #### With CI plot - rr\n    rr = data.frame( rrm.all)\n    names(rr)=c(\"cc\",\"Metric\", \"Low\", \"High\")\n    rr.noci.df=data.frame(rrm.all)\n    names(rr.noci.df)=c(\"cc\",\"Metric\", \"Low\", \"High\")\n    rr.noci.df$Low=rr.noci.df$Metric\n    rr.noci.df$High=rr.noci.df$Metric\n    rr.noci.df$cigroup=\"Without CI\"\n    rr$cigroup=\"With CI\"\n    rr.noci.df$allz=\"CC added to all cells\"\n    rr$allz=\"CC added to all cells\"\n\n    #### With CI plot - rr2\n    rr2=data.frame(rrm.zero)\n    names(rr2)=c(\"cc\",\"Metric\", \"Low\", \"High\")\n    rr2.noci.df=data.frame(rrm.zero)\n    names(rr2.noci.df)=c(\"cc\",\"Metric\", \"Low\", \"High\")\n    rr2.noci.df$Low=rr2.noci.df$Metric\n    rr2.noci.df$High=rr2.noci.df$Metric\n    rr2.noci.df$cigroup=\"Without CI\"\n    rr2$cigroup=\"With CI\"\n    rr2.noci.df$allz=\"CC added only to 0 cells\"\n    rr2$allz=\"CC added only to 0 cells\"\n\n    rr.combined.df=rbind(rr,rr.noci.df,rr2,rr2.noci.df)\n\n    p<-ggplot(rr.combined.df,aes(cc,Metric))+geom_line()+\n      geom_point(data=rr.combined.df,aes(x=cc,y=Metric))+\n      geom_line(data=rr.combined.df)+\n      geom_ribbon(aes(ymin=Low, ymax=High), alpha=0.2) +\n      labs(title = \"Relative Risk\") +\n      ylab(\"Relative Risk\") +\n      facet_grid(cigroup~allz, scales = \"free\" )\n    # End of if condition with CI\n    print(p)\n    } else {\n\n  rr = data.frame( rrm.all)\n  names(rr)=c(\"cc\",\"Metric\", \"Low\", \"High\")\n  rr2 = data.frame( rrm.zero)\n  names(rr2)=c(\"cc\",\"Metric\", \"Low\", \"High\")\n\n  l1.rr=as.character(rr$cc[6])\n  l2.rr=as.character(rr2$cc[6])\n  cpoint.rr=rr2$cc[6]\n  cpoint.rr2=rr2$cc[6]\n  rr2g.rrz=rr2[6,]\n  rr1g.rr=rr[6,]\n  p<-ggplot(rr,aes(cc,Metric))+geom_line(aes(color=\"CC added to all cells\"))+\n    geom_point(data=rr,aes(x=cc,y=Metric))+\n    geom_line(data=rr2,aes(color=\"CC added to only the 0 cells\"))+\n    geom_point(data=rr2,aes(x=cc,y=Metric))+\n    geom_point(data=rr2g.rrz, colour=\"blue\") +  # this adds a blue point\n    geom_text(data=rr2g.rrz, label=l2.rr, hjust=0,vjust=0)+ # this adds a label for the blue point\n    geom_point(data=rr1g.rr, colour=\"red\") +  # this adds a red point\n    geom_text(data=rr1g.rr, label=l1.rr, hjust=0,vjust=0)+ # this adds a label for the red point\n    labs(title = \"Relative Risk\") +\n    ylab(\"Relative Risk\") +\n    geom_hline(yintercept=1)\n\n  print(p)\n    } #End of plot without CI\n\n  } # End of if condition when there is both reversal\n\n} # End of RR function\n\n\n#'###################################################################################################\n#'  Given an 2x2 table with ai, bi, ci and di, if there are any zero cells, a continuity correction\n#'  (CC) is added upto 0.5. This function checks if this addition of continuity correction causes\n#'  the reversing the Odds Ratio, Relative Risk and Risk Difference.\n#'  We provide 2 ways to add this CC. Adding CC to all the cells or only to the zero cells.\n#'  The function will identify if there is a reversal and also give the point of reversal.\n#'  The continuity correction can be also graphed if the option is selected.\n#' @param ai - Numeric value\n#' @param bi - Numeric value\n#' @param ci - Numeric value\n#' @param di - Numeric value\n#' @param With.CI - Logical TRUE/FALSE. Default is FALSE\n#' @details  The function only analyzes 2x2 tables where there is at least 1 zero cell.\n#' By default it calculates the reversal point (if it exists) for various values of continuity correction\n#' (CC) starting from 10^(-8) (suggested by reference [5]) all the way to 0.5. If there is a reversal due to CC\n#' the function returns the graph showing the reversal for Risk Difference.\n#' The function adds the CC using 2 methods.\n#' In Method 1 - it adds CC to all the cells (called All) which is a widespread practice\n#' In Method 2 - it adds CC to only the zero cells (called Only.Zero)\n#' Option is provided to graph the confidence interaval (CI).\n#' @return A graph showing the reversal if there is reversal. Or text if there is no reversal\n#' @family 2x2 Summary methods\n#' @examples\n#'## Example 1 - From reference [2] - reversal only when CC is added to the zero cells alone\n#' ai=80; bi=1; ci=39; di=0\n#' Plot.reversals.RD(ai,bi,ci,di, With.CI=FALSE)\n#'##  Example 2 - From reference [3] -reversal when CC is added\n#' ai=1; bi=33; ci=0; di=7\n#' Plot.reversals.RD(ai,bi,ci,di, With.CI=FALSE)\n#'## Example 3 - Above example with CI\n#' ai=1; bi=33; ci=0; di=7\n#' Plot.reversals.RD(ai,bi,ci,di, With.CI=TRUE)\n#' @references\n#' [1] J Sweeting, Michael, Alexander J Sutton, and Paul C Lambert.\n#' \"What to add to nothing? Use and avoidance of continuity corrections in meta-analysis of sparse data.\"\n#' Statistics in medicine 23.9 (2004): 1351-1375.\n#' [2] Song H, Zhu J, Lu D. Molecular-targeted first-line therapy for advanced gastric cancer.\n#' Cochrane Database of Systematic Reviews 2016, Issue 7. Art. No.: CD011461.\n#' [3] Lensen SF, Manders M, Nastri CO, Gibreel A, Martins WP, Templer GE, Farquhar C.\n#' Endometrial injury for pregnancy following sexual intercourse or intrauterine insemination.\n#' Cochrane Database of Systematic Reviews 2016, Issue 6. Art. No.: CD011424.\n#' [4] Nidorf SM, Eikelboom JW, Budgeon CA, Thompson PL.\n#' Low-dose colchicine for secondary prevention of cardiovascular disease.\n#' Journal of the American College of Cardiology 2013;61(4):404-10.\n#' @export\nPlot.reversals.RD<-function(ai,bi,ci,di,With.CI=FALSE){\n  if ((class(ai) != \"numeric\") || class(bi) != \"numeric\" ||\n      class(ci) != \"numeric\"  || class(di) != \"numeric\" )  stop(\"Inputs ai,bi,ci and di have to be numeric\")\n  if (ai*bi*ci*di>0)  stop(\"At least one of the inputs ai,bi,ci or di have to be zero\")\n  if ((class(With.CI)) != \"logical\") stop(\"With.CI has to be either TRUE or FALSE\")\n\n  mrt = data.frame(a=ai,b=bi,c=ci,d=di)\n  tpm8=1/100000000\n  tpm4=1/10000\n  cc=Metric=Low=High=NULL\n\n  cc.vals = c(tpm8,tpm4,0.0011,0.011,0.0151,0.11,.151,.21,.251,.31,.351,.41,.451,.5)\n\n\n  vbn= In.Each.Row(mrt[1,],cc.vals)\n  svbn=cbind(mrt[1,],vbn)\n  ttrange.df=Find.RS.metric(svbn)\n  if(ttrange.df$RS.all.rd ==0 & ttrange.df$RS.zero.zrd==0){\n    return(\"There is no reversal to Plot\")\n  }\n\n  RS.all.rd=ttrange.df$RS.all.rd[1]\n  RS.zero.rd=ttrange.df$RS.zero.zrd[1]\n\n  # Generating sequence and then calling rma for OR/RR/RD with CI\n  if(RS.all.rd>0){RS.all.rd.seq=Find.sequence.rma(RS.all.rd); rdm.all=Find.rma.metric(ai,bi,ci,di,RS.all.rd.seq, 3)}\n  if(RS.zero.rd>0){RS.zero.rd.seq=Find.sequence.rma(RS.zero.rd); rdm.zero=Find.rma.metric(ai,bi,ci,di,RS.zero.rd.seq, 6)}\n\nif(RS.all.rd==0){\n  if(With.CI==TRUE){\n    #### With CI plot\n    rd2 = data.frame( rdm.zero)\n    names(rd2)=c(\"cc\",\"Metric\", \"Low\", \"High\")\n    rd2.noci.df=data.frame(rdm.zero)\n    names(rd2.noci.df)=c(\"cc\",\"Metric\", \"Low\", \"High\")\n    rd2.noci.df$Low=rd2.noci.df$Metric\n    rd2.noci.df$High=rd2.noci.df$Metric\n    rd2.noci.df$cigroup=\"Without CI\"\n    rd2$cigroup=\"With CI\"\n    rd2.noci.df$allz=\"CC added only to 0 cells\"\n    rd2$allz=\"CC added only to 0 cells\"\n    rd.combined.df=rbind(rd2,rd2.noci.df)\n\n    p<-ggplot(rd.combined.df,aes(cc,Metric))+geom_line()+\n      geom_point(data=rd.combined.df,aes(x=cc,y=Metric))+\n      geom_line(data=rd.combined.df)+\n      geom_ribbon(aes(ymin=Low, ymax=High), alpha=0.2) +\n      labs(title = \"Risk Difference\", subtitle = \"No reversal when CC added to all cells\") +\n      ylab(\"Risk Difference\") +\n      facet_wrap(allz~cigroup, scales = \"free\" )\n  # End of if condition with CI\n    print(p)\n    } else {\n  rd2 = data.frame( rdm.zero)\n  names(rd2)=c(\"cc\",\"Metric\", \"Low\", \"High\")\n\n  l2.rd=as.character(rd2$cc[6])\n  cpoint.rd2=rd2$cc[6]\n\n  rd2g.rdz=rd2[6,]\n\n  p<-ggplot(rd2,aes(cc,Metric))+\n    geom_line(data=rd2)+\n    geom_point(data=rd2,aes(x=cc,y=Metric))+\n    geom_point(data=rd2g.rdz, colour=\"blue\") +  # this adds a blue point\n    geom_text(data=rd2g.rdz, label=l2.rd,  hjust=0,vjust=0)+ # this adds a label for the blue point\n    labs(title = \"Risk Difference\", subtitle = \"No reversal when CC added to all cells\") +\n    ylab(\"Risk Difference\") +\n    geom_hline(yintercept=0)\n\n  print(p)\n  } #End of plot without CI\n} # End of if condition when there is only 1 reversal\n\n\n\n###############################################################################################\n###########Creates a plot for both RD.all and RD.zero without CI ##############################\nif(RS.all.rd>0 & RS.zero.rd>0){\n  if(With.CI==TRUE){\n    #### With CI plot -rd\n    rd = data.frame( rdm.all)\n    names(rd)=c(\"cc\",\"Metric\", \"Low\", \"High\")\n    rd.noci.df=data.frame(rdm.all)\n    names(rd.noci.df)=c(\"cc\",\"Metric\", \"Low\", \"High\")\n    rd.noci.df$Low=rd.noci.df$Metric\n    rd.noci.df$High=rd.noci.df$Metric\n    rd.noci.df$cigroup=\"Without CI\"\n    rd$cigroup=\"With CI\"\n    rd.noci.df$allz=\"CC added to all cells\"\n    rd$allz=\"CC added to all cells\"\n\n    #### With CI plot -rd2\n    rd2 = data.frame( rdm.zero)\n    names(rd2)=c(\"cc\",\"Metric\", \"Low\", \"High\")\n    rd2.noci.df=data.frame(rdm.zero)\n    names(rd2.noci.df)=c(\"cc\",\"Metric\", \"Low\", \"High\")\n    rd2.noci.df$Low=rd2.noci.df$Metric\n    rd2.noci.df$High=rd2.noci.df$Metric\n    rd2.noci.df$cigroup=\"Without CI\"\n    rd2$cigroup=\"With CI\"\n    rd2.noci.df$allz=\"CC added only to 0 cells\"\n    rd2$allz=\"CC added only to 0 cells\"\n\n    rd.combined.df=rbind(rd,rd.noci.df,rd2,rd2.noci.df)\n\n    p<-ggplot(rd.combined.df,aes(cc,Metric))+geom_line()+\n      geom_point(data=rd.combined.df,aes(x=cc,y=Metric))+\n      geom_line(data=rd.combined.df)+\n      geom_ribbon(aes(ymin=Low, ymax=High), alpha=0.2) +\n      labs(title = \"Risk Difference\") +\n      ylab(\"Risk Difference\") +\n      facet_grid(cigroup~allz, scales = \"free\" )\n    # End of if condition with CI\n    print(p)\n    } else {\n\n  rd = data.frame( rdm.all)\n  names(rd)=c(\"cc\",\"Metric\", \"Low\", \"High\")\n  rd2 = data.frame( rdm.zero)\n  names(rd2)=c(\"cc\",\"Metric\", \"Low\", \"High\")\n  # rd2$group<-\"NI\"\n  # rd2$group[6]<-\"Important\"\n\n  l1.rd=as.character(rd$cc[6])\n  l2.rd=as.character(rd2$cc[6])\n  cpoint.rd=rd$cc[6]\n  cpoint.rd2=rd2$cc[6]\n\n  rd2g.rdz=rd2[6,]\n  rd1g.rd=rd[6,]\n\n  p<-ggplot(rd,aes(cc,Metric))+geom_line(aes(color=\"CC added to all cells\"))+\n    geom_point(data=rd,aes(x=cc,y=Metric))+\n    geom_line(data=rd2,aes(color=\"CC added to only the 0 cells\"))+\n    geom_point(data=rd2,aes(x=cc,y=Metric))+\n    geom_point(data=rd2g.rdz, colour=\"blue\") +  # this adds a blue point\n    geom_text(data=rd2g.rdz, label=l2.rd,  hjust=0,vjust=0)+ # this adds a label for the blue point\n    geom_point(data=rd1g.rd, colour=\"red\") +  # this adds a red point\n    geom_text(data=rd1g.rd, label=l1.rd,  hjust=0,vjust=0)+ # this adds a label for the red point\n    labs(title = \"Risk Difference\") +\n    ylab(\"Risk Difference\") +\n    geom_hline(yintercept=0)\n\n  print(p)\n    } #End of plot without CI\n\n  } # End of if condition when there is both reversal\n\n} # End of RD function\n\n",
    "created" : 1501299597531.000,
    "dirty" : false,
    "encoding" : "ISO8859-1",
    "folds" : "",
    "hash" : "4021814697",
    "id" : "CBF09B05",
    "lastKnownWriteTime" : 1501267100,
    "last_content_update" : 1501267100,
    "path" : "D:/Research/CDA/vcdPlus/R/303.Generate-graph-functions.R",
    "project_path" : "R/303.Generate-graph-functions.R",
    "properties" : {
    },
    "relative_order" : 14,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}